Reflected XSS, zararlı bir scriptin bir web uygulamasına gönderilip kullanıcının tarayıcısında yansıtıldığı bir saldırı türüdür. Bu saldırılar genellikle, kullanıcıların sosyal mühendislik yöntemleriyle aldatılarak XSS payload'ını içeren bir linki tıklamaları sonucunda gerçekleşir. Bu tür bağlantılar, zararlı kodları içeren bir HTTP isteğini tetikler ve sunucu, bu kodları HTTP yanıtında geri yansıtarak kullanıcının tarayıcısında çalışmasına neden olur. Bu süreç, tek bir istek/yanıt döngüsüyle tamamlandığı ve kullanıcı etkileşimi gerektirdiği için Reflected XSS olarak bilinir, çünkü her kurban için saldırı yeniden gerçekleştirilmelidir.

### Reflected XSS Saldırısı Örneği:

Bir saldırgan, zararlı bir script içeren ve bu scriptin web uygulaması tarafından gösterilmesini sağlayan bir URL hazırlayabilir:

```auto
https://example.com/home?search=<script>alert('XSS')</script>
```

Bu örnekte sayfadaki arama kutusu çalıştırıldığında "search" parametresi ile yapılan HTTP GET isteğinde bulunan XSS payload'u sayfaya dahil edilmiştir.

URL'ye tıklandığında, XSS payload'u kullanıcının tarayıcısında, kullanıcının o anda etkileşimde bulunduğu uygulamanın bağlamında çalıştırılır. Bu script, kullanıcının bilgilerine erişebilir veya kötü niyetli eylemler gerçekleştirebilir.

Uygulamanın İncelenmesi

![](https://storage.hackviser.com/file/hackviser-prod/trainings/sections/images/7cf943b0-ab4f-4a2b-9ebe-1c4350d2d52c/reflected-xss-search-0b6ff44d5.webp)

![](https://storage.hackviser.com/file/hackviser-prod/trainings/sections/images/7cf943b0-ab4f-4a2b-9ebe-1c4350d2d52c/dev-tools-reflected-search-54a166190.webp)

Bu sayfada bir arama kutusu görülmektedir. "cars" kelimesi ile bir arama yapılarak verilen tepki gözlenmiştir. Aratılan verinin uyarı kutusuna yazdırıldığı görülmüştür. "q" GET parametresi ile de sunucuya verinin gönderildiği görülmektedir.

Zafiyetin Tespit Edilmesi

![](https://storage.hackviser.com/file/hackviser-prod/trainings/sections/images/7cf943b0-ab4f-4a2b-9ebe-1c4350d2d52c/reflected-xss-alert-abcc6b3de.webp)

![](https://storage.hackviser.com/file/hackviser-prod/trainings/sections/images/7cf943b0-ab4f-4a2b-9ebe-1c4350d2d52c/dev-tools-reflected-alert-61048b028.webp)

İncelenen arama kutusuna basit bir XSS payload'ı yani sayfada "1" metnini içeren bir uyarı kutusu çıkartan bir JavaScript kodu yazılıp aratılmıştır. Kodun işe yaradığı gözlemlenmiştir. HTML kodlarının arasına dahil edilen JavaScript kodu başarıyla çalıştırılmıştır.

```auto
?q=<script>alert(1)</script>
```

### HTML Injection

JavaScript kodlarının yanı sıra sayfanın içerisine HTML kodlarının da dahil edilebilmesi mümkündür. Bu sayede sayfanın tasarımı değiştirilebilir. Saldırganın amaçları doğrultusunda tasarlanmış yanıltıcı bir sosyal mühendislik saldırısına dönüşebilir. Bu saldırı tipine HTML Injection adı verilmektedir.

![](https://storage.hackviser.com/file/hackviser-prod/trainings/sections/images/7cf943b0-ab4f-4a2b-9ebe-1c4350d2d52c/html-injection-d083f4eb6.webp)

```auto
?q=<h1 style="color:green;">TEST</h1>
```

Burada h1 başlık etiketinin içerisinde "TEST" ifadesi yazdırılmıştır. Rengi ise yeşil olarak belirlenmiştir.

### Kaynak Kod Analizi

Zafiyetin temel sebebi, kullanıcı girdisinin yeterli kontrolden veya filtreden geçirilmeden doğrudan tarayıcıda gösterilmesidir. Bu durum, güvenlik açıklarına ve özellikle XSS saldırılarına yol açabilir.

Zafiyetli Kod Örneği

Aşağıdaki PHP kod parçası, kullanıcıdan alınan bir girdiyi kontrol etmeden doğrudan HTML içerisinde göstermektedir. Bu, XSS saldırıları için potansiyel bir zemin hazırlar.

```auto
<?php 
    if (isset($_GET['q'])) {
        $q = $_GET['q'];
        echo '<div class="alert alert-danger" role="alert">
            No Result Found for <b>' . $q . '</b> 
        </div>';
    } 
?>
```

Bu kod, URL'deki

q

adlı GET parametresinin varlığını kontrol ederek başlar. Eğer bu parametre mevcutsa,

q

parametresinin değeri

$q

değişkenine atanır. İlk kod örneğinde,

$q

değişkeni doğrudan bir HTML

<div>

içinde

<b>

etiketleri arasında yansıtılır.

GET metodu ile alınan "q" parametresi, herhangi bir güvenlik önlemi alınmadan

<b>

etiketleri arasında doğrudan kullanılıyor. Eğer "q" parametresi olarak

<script>alert(1)</script>

gibi bir script gönderilirse, bu script kullanıcının tarayıcısında çalıştırılacaktır ve uyarı kutusu içeriisnde 1 ifadesi yazdırılıcaktır.

Güvenli Kod Örneği

Bu örnekte, **htmlspecialchars** fonksiyonu kullanılarak kullanıcı girdisi güvenli bir şekilde ekrana bastırılmaktadır. Bu fonksiyon, HTML'e özgü özel karakterleri (

<

,

>

,

&

,

"

,

'

gibi) onların HTML varlıklarına (

&lt;

,

&gt;

,

&amp;

,

&quot;

,

&#039;

gibi) dönüştürür.

```auto
<?php 
    if (isset($_GET['q'])) {
        $q = $_GET['q'];
        echo '<div class="alert alert-danger" role="alert">
            No Result Found for <b>' . htmlspecialchars($q) . '</b> 
        </div>';
    } 
?>
```

Bu düzenleme ile, "q" parametresi içindeki potansiyel zararlı scriptler zararsız metne dönüştürülerek XSS saldırıları önlenmiş olur. Örneğin, kullanıcı

<script>

tag'ı gönderse bile, bu tag tarayıcı tarafından bir HTML elementi olarak değil, sadece düz metin olarak işlenecektir.